<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="DRAW" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">var xoffset, yoffset, xsize, ysize;
xoffset = view_xview[0];
yoffset = view_yview[0];
xsize = view_wview[0];
ysize = view_hview[0];

draw_set_halign(fa_left);
draw_set_valign(fa_top);
draw_set_color(c_white);

if (isTyping)
{
    // Fadein
    if (alpha &lt; 0.6)
    {
        alpha += 0.1;
    }
    if (alpha &gt;= 0.6)
    {
        alpha = 0.6;
    }
}
else if (alpha &gt; 0)
{
    // Fadeout
    alpha -= 0.2;
    alpha = max(0, alpha);
}

// Draw the window
if alpha &gt; 0
{
    draw_sprite_ext(ChatS, 0, xoffset + 5, yoffset + 200, 1, 1, 0, c_white, alpha);
    draw_sprite_ext(SliderS, 0, xoffset + 380, yoffset + 225 + slider_offset, 1, 1, 0, c_white, alpha);
}

var size, beginpos;
size = ds_list_size(chatLog) - numberLinesVisible;
beginpos = floor((slider_offset / 180) * size);

var message, t_alpha;
for(i=beginpos; i&lt;beginpos+numberLinesVisible; i+=1)
{
    message = ds_list_find_value(chatLog, i)
    message_offset = 0;
    
    if (isTyping)
    {
        t_alpha = 1;
    }
    else if ((i-beginpos) &gt; 6)
    {
        t_alpha = ((i-beginpos) - (numberLinesVisible-6)) * 0.2;
    }
    else
    {
        t_alpha = 0;
    }

    while string_count("/:/", message) &gt; 0
    {
        var nextpos, text, color;
        // Get the color from the prefix
        color = getColorCode(string_copy(message, 4, COLOR_RGB_LENGTH));
        // Check if there's another prefix in this message
        nextpos = string_pos("/:/", string_copy(message, 4, string_length(message))) + 3;
        if nextpos == 3
        {
            // There isn't an color code in the future, we can draw everything
            text = string_copy(message, 4+COLOR_RGB_LENGTH, string_length(message));
            message = "";
        }
        else
        {
            // There is another, crop to it
            // What we'll draw this time
            text = string_copy(message, 4+COLOR_RGB_LENGTH, nextpos-COLOR_RGB_LENGTH-4);
            // What we need to set with a new color
            message = string_copy(message, nextpos, string_length(message));
        }
        draw_text_color(xoffset + message_offset + 20, yoffset + 215 + ((i - beginpos) * 15), text, color, color, color, color, t_alpha);
        // Offset the draw pos of the next strip of text, so that it doesn't overwrite the old one
        message_offset += string_width(text);
    }
}

if (isTyping)
{
    draw_text(xoffset + 20, yoffset + 480, string_copy(keyboard_string, 0, 48));
}
</argument>
      </arguments>
    </action>
  </actions>
</event>
